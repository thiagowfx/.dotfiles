#!/bin/sh
#
# Sourced by most display managers (GDM, LightDM, LXDM, SDDM, etc).
# ~/.xinitrc is configured to source it as well.
#
# https://wiki.archlinux.org/title/Xprofile

# Make Chrome pick up proxy settings stored in gconf.
export DESKTOP_SESSION=gnome

# Fix decoration for java applications for tiling window managers.
export _JAVA_AWT_WM_NONREPARENTING=1

# Set HiDPI settings for GTK3+.
export GDK_SCALE=2
export GDK_DPI_SCALE=0.5

# Set HiDPI settings for QT.
export QT_FONT_DPI=192

# Autostart XDG applications (.desktop files).
xdg_autostart() {
	# https://wiki.archlinux.org/title/XDG_Autostart
	dex --autostart --environment X-Tiling &
}

# Set up screensaver and auto lockscreen.
screensaver() {
	xset s 1200  # 20min
	if hash xsecurelock >/dev/null 2>&1; then
		XSECURELOCK_COMPOSITE_OBSCURER=0 xss-lock -l -n /usr/lib/xsecurelock/dimmer -- xsecurelock &
	fi
}

# Set X11 wallpaper.
wallpaper() {
	[ -x ~/.fehbg ] && ~/.fehbg
}

# Start misc applications for Arch Linux.
arch_autostart() {
	screensaver
	wallpaper

	picom -i 0.95 --daemon --backend glx
	udiskie --smart-tray &

	xdg_autostart
}

[ -f "/etc/arch-release" ] && arch_autostart
