# Config file for tmux(1).
# https://github.com/tmux/tmux/wiki/FAQ
#
# Tmux initialization with SSH:
#   -t -- tmux new -A -s main
#
# Reload tmux config:
#   C-a r
#
# Plugin management:
#   Install new plug-ins: C-a I
#   Update all plug-ins: C-a U
#   Uninstall old plug-ins: C-a Alt-u
#
# Hierarchy and terminology.
#   Session (C-a s)
#   \- Window (C-a w)
#    \- Pane (C-a q)
#
# List all commands:
#   :list-commands
#
# List all keybindings:
#   C-a ?
#   :list-keys
#
# Show option value:
#   :show-options -g -s <name>
#
# Prefix is C-a.

# Set up tmux plug-in manager
set -g @plugin 'tmux-plugins/tpm'

# Copycat plugin
#   C-a / to trigger search
#   C-a C-f to copy a file
#   C-a C-u to copy an URL
set -g @plugin 'tmux-plugins/tmux-copycat'

# Add prefix highlight
# Theme should invoke `#{prefix_highlight}` to display it
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# Prefix highlight options
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_show_sync_mode 'on'

# Facebook PathPicker
#   C-a f to invoke fpp
set -g @plugin 'tmux-plugins/tmux-fpp'

# Prefix key
set -g prefix C-a
unbind C-b

# C-a a and C-a C-a both go to beginning of line.
bind a send-prefix

# Go to last window.
bind C-a last-window

# Set vi mode keybindings. Mostly intended for copy mode.
set -g mode-keys vi

# Smoother scrolling with mouse in copy mode.
# https://stackoverflow.com/a/46617618/1745064
# bind-key -T copy-mode-vi WheelUpPane send-keys -X scroll-up
# bind-key -T copy-mode-vi WheelDownPane send-keys -X scroll-down

# Half-page scrolling with mouse in copy mode.
bind-key -T copy-mode-vi WheelUpPane send-keys -X halfpage-up
bind-key -T copy-mode-vi WheelDownPane send-keys -X halfpage-down

# Use v in addition to SPC to begin copy-mode selection.
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel  # alt: copy-selection

# Start to count from 1 just like tiling window managers
set -g base-index 1
setw -g pane-base-index 1

# Set $TERM and force 256 colors.
# https://github.com/tmux/tmux/wiki/FAQ#how-do-i-use-a-256-colour-terminal
# https://github.com/tmux/tmux/wiki/FAQ#how-do-i-use-rgb-colour
set -g default-terminal 'tmux-256color'
set -as terminal-overrides ',tmux-256color:Tc'

# Enable mouse mode
#   C-a m to toggle
set -g mouse on
bind m set -g mouse

# Enable automatic rename but do not change window name automatically once it is manually set
set -g automatic-rename on
set -g allow-rename off

# Resize to smallest possible or smallest session size
setw -g aggressive-resize on

# Increase scrollback buffer size
set -g history-limit 50000

# Display tmux messages for 3 seconds.
set -g display-time 3000

# Just send ESC.
set -g escape-time 0

# Emacs key bindings in tmux command prompt (C-a + :) are better than vi keys, even for vi users
set -g status-keys emacs

# Renumber windows sequentially after closing any of them.
set -g renumber-windows on

# Set WM window title string.
set -g set-titles on
set -g set-titles-string "#H #S #I:#W" # hostname session window:program

# User-friendly shortcuts to split windows, split windows on current path.
bind - split-window -v -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"

# Set vi keys for changing windows.
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Kill a pane. Confirm before killing.
# Native: C-a x.
bind C-k confirm kill-pane

# Reload tmux config.
bind r source ~/.tmux.conf \; display "Sourced ~/.tmux.conf!"

# Change default start directory.
bind _ attach -c '#{pane_current_path}' \; display "Changed start directory to #{pane_current_path}."

# Goyo, toggle status bar visibility for a distraction-free experience
bind g set status

# Do not suspend-client
unbind C-z

# Set message style, i.e. C-a :
set -g message-style fg=yellow,bg=black,bright

# Set status bar style.
set -g status-style fg=white,bg=default,bright

# Set status bar size.
set -g status-left-length 40
set -g status-right-length 65

# Set status bar content.
set -g status-left "#[fg=cyan]#H #[fg=colour242]‚Ä¢ "
set -g status-right "#{prefix_highlight} #{?window_zoomed_flag,üîç ,}#{?mouse,,#[dim]mouse:off}"

# Set non-active window title style.
set -g window-status-format "#I:#W"
setw -g window-status-style fg=colour242,bg=default,dim

# Set active window title style.
set -g window-status-current-format "#I:#W"
setw -g window-status-current-style fg=white,bg=default,bright

# Set bell style.
set -g window-status-bell-style fg=red,bg=default,bright

# Make active pane more distinct.
set -g pane-active-border-style fg=yellow,bg=default

# Load corp configs if any.
if "[ -f ~/.tmux.conf_corp ]" 'source ~/.tmux.conf_corp'

# Initialize tmux plugin manager.
# This line should be at the very bottom of tmux.conf.
run '~/.tmux/plugins/tpm/tpm'
