#!/bin/sh
#
# Upgrade and clean an Unix system.
#

# Exit immediately upon receiving C-c.
trap ctrl_c INT
function ctrl_c	(){
	exit 1
}

# Ask for sudo password upfront.
sudo -v

# One pseudo package manager to rule them all.
if command -v pacapt &>/dev/null; then
	pacapt -Syu
	pacapt -Sccc
	exit
fi

# macOS: system
if [[ "$(uname)" == "Darwin" ]]; then
	sudo softwareupdate -i -a

	# macOS: homebrew
	if command -v brew &>/dev/null; then
		brew update
		brew upgrade
		brew cleanup
		brew prune
		brew doctor
		exit
	fi

	# macOS: MacPorts
	if command -v port &>/dev/null; then
		sudo port selfupdate
		sudo port upgrade outdated
		sudo port uninstall leaves
		exit
	fi
fi

# Arch Linux
if [[ -e /etc/arch-release ]] && command -v pacman &>/dev/null; then
	sudo pacman -Syu
	sudo pacman -Rnsc $(pacman -Qdtq)
	sudo paccache -r
	exit
fi

# Gentoo Linux
if [[ -e /etc/gentoo-release ]] && command -v emerge &>/dev/null; then
	sudo emerge --sync
	sudo emerge -auDN --with-bdeps y --keep-going @world
	sudo emerge -v --depclean
	sudo revdep-rebuild -v
	sudo etc-update
	sudo eclean -d distfiles
	exit
fi

# Debian-based Linux
if [[ -e /etc/debian_version ]] && command -v apt &>/dev/null; then
	sudo apt update
	sudo apt upgrade
	sudo apt-get dist-upgrade
	sudo apt-get autoremove
	exit
fi

echo "error: your system and/or package manager could not be identified." >&2
exit 1
