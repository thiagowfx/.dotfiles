#!/bin/sh
# Upgrade and clean an Unix system.
#

# MyRepos
if command -v mr &>/dev/null; then
	set +x
	pushd .
	cd $HOME && mr update
	popd
	set -x
fi

# OS X: homebrew
if [[ "$(uname)" == "Darwin" ]] && command -v brew &>/dev/null; then
	set +x
	brew update
	brew upgrade --all
	brew cleanup
	brew prune
	brew doctor
	exit
fi

# OS X: Mac Ports
if [[ "$(uname)" == "Darwin" ]] && command -v port &>/dev/null; then
	set +x
	sudo port selfupdate
	sudo port upgrade outdated
	sudo port uninstall leaves
	exit
fi

# Arch Linux
if [[ -e /etc/arch-release ]] && command -v pacman &>/dev/null; then
	set +x
	sudo pacman -Syu
	sudo pacman -Rnsc $(pacman -Qdtq)
	sudo paccache -r
	exit
fi

# Gentoo Linux
if [[ -e /etc/gentoo-release ]] && command -v emerge &>/dev/null; then
	set +x
	sudo emerge --sync
	sudo emerge -auDN --with-bdeps y --keep-going @world
	sudo emerge -v --depclean
	sudo revdep-rebuild -v
	sudo etc-update
	sudo eclean -d distfiles
	exit
fi

# Debian-based Linux
if [[ -e /etc/debian_version ]] && command -v apt &>/dev/null; then
	set +x
	sudo apt update
	sudo apt upgrade
	sudo apt full-upgrade
	sudo apt autoremove
	exit
fi

echo "ERROR: your system could not be identified." && exit 1
